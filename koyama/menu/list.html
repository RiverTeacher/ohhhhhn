<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¢ãƒ—ãƒªä¸€è¦§</title>

<style>
body{
    margin:0;
    padding:20px;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Yu Gothic",sans-serif;
    background:#f5f5f7;
}
h2{text-align:center;margin-bottom:24px}

.app-list{list-style:none;padding:0;max-width:620px;margin:auto}

.app-card{
    background:#fff;
    border-radius:18px;
    padding:16px 18px;
    margin-bottom:16px;
    box-shadow:0 6px 16px rgba(0,0,0,.06);
    display:flex;
    gap:16px;
    cursor:pointer;
    transition:transform .2s;
}
.app-card:active{transform:scale(.97)}

.app-icon{font-size:2.6rem;width:56px;text-align:center}
.app-title{font-weight:600;margin:0 0 4px}
.app-desc{font-size:.85rem;color:#666;margin:0}

.app-right{
    margin-left:auto;
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:6px;
}

.app-status{
    font-size:.75rem;
    font-weight:600;
    padding:6px 10px;
    border-radius:999px;
}
.status-locked{color:#c62828;background:#fdeaea}
.status-unlocked{color:#558b2f;background:#eef7e6}
.status-disabled{color:#757575;background:#eee}

.relock-btn{
    font-size:.7rem;
    border:none;
    padding:4px 10px;
    border-radius:999px;
    background:#f1f1f1;
    cursor:pointer;
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š ===== */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
}
.modal.active{display:flex}
.modal-box{
    background:#fff;
    border-radius:20px;
    width:90%;
    max-width:340px;
    padding:24px;
    text-align:center;
}
.modal-buttons{display:flex;gap:10px;margin-top:12px}
.modal-btn{
    flex:1;
    border:none;
    padding:10px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
}
.btn-ok{background:#007bff;color:#fff}
.btn-cancel{background:#eee}
.btn-danger{background:#c62828;color:#fff}

.modal-input{
    width:100%;
    padding:10px;
    border-radius:10px;
    border:1px solid #ccc;
}
.modal-error{
    color:#c62828;
    font-size:.8rem;
    display:none;
}
</style>
</head>

<body>

<h2>ã‚¢ãƒ—ãƒªä¸€è¦§</h2>
<ul id="appList" class="app-list"></ul>

<!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ -->
<div id="passwordModal" class="modal">
<div class="modal-box">
    <h3>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h3>
    <input id="pwInput" type="password" class="modal-input">
    <div id="pwError" class="modal-error">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</div>
    <div class="modal-buttons">
        <button class="modal-btn btn-cancel" onclick="closePassword()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="modal-btn btn-ok" onclick="submitPassword()">è§£ç¦</button>
    </div>
</div>
</div>

<!-- å†ãƒ­ãƒƒã‚¯ -->
<div id="relockModal" class="modal">
<div class="modal-box">
    <h3>å†ãƒ­ãƒƒã‚¯ç¢ºèª</h3>
    <p>æ¬¡å›èµ·å‹•æ™‚ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™</p>
    <div class="modal-buttons">
        <button class="modal-btn btn-cancel" onclick="closeRelock()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="modal-btn btn-danger" onclick="confirmRelock()">OK</button>
    </div>
</div>
</div>

<!-- å‘ãè­¦å‘Š -->
<div id="orientationModal" class="modal">
<div class="modal-box">
    <h3 id="oriTitle"></h3>
    <p id="oriText"></p>
    <button class="modal-btn btn-ok" onclick="closeOrientation()">OK</button>
</div>
</div>

<script>
/* ===== ã‚¢ãƒ—ãƒªå®šç¾© ===== */
const appsConfig=[
{
    id:"chat",
    icon:"ğŸ’¬",
    name:"ãƒãƒ£ãƒƒãƒˆ",
    description:"ç¾åœ¨ä½¿ç”¨ä¸å¯",
    url:"https://www3.cbox.ws/box/?boxid=3550995&boxtag=ymqqtx",
    orientation:"portrait",
    password:null,
    version:null,
    enabled:false
},
{
    id:"koyama",
    icon:"ğŸ”ï¸",
    name:"é€²æ’ƒã®å°å±±",
    description:"ç„¡é™ã«è¿«ã£ã¦ãã‚‹å°å±±ã‚’å€’ã™ã‚²ãƒ¼ãƒ ",
    url:"https://riverteacher.github.io/ohhhhhn/koyama/game/",
    orientation:"landscape",
    password:"koyama2025",
    version:"3",
    enabled:true
}
];

/* ===== Cookie ===== */
const setC=(n,v,d)=>document.cookie=`${n}=${v};expires=${new Date(Date.now()+d*864e5).toUTCString()};path=/`;
const getC=n=>(document.cookie.match(new RegExp('(^| )'+n+'=([^;]+)'))||[])[2];
const delC=n=>document.cookie=`${n}=;Max-Age=0;path=/`;

const list=document.getElementById("appList");
let currentApp=null;
let pendingUrl=null;
let requiredOrientation=null;

/* ===== æç”» ===== */
function render(){
    list.innerHTML="";
    appsConfig.forEach(app=>{
        const u=`unlock_${app.id}`;
        const v=`ver_${app.id}`;
        if(getC(v)!==app.version){ delC(u); delC(v); }

        const unlocked=!!getC(u);
        let status,cls;

        if(!app.enabled){
            status="ã‚¢ãƒ—ãƒªä½¿ç”¨ä¸å¯"; cls="status-disabled";
        }else if(app.password && !unlocked){
            status="ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™"; cls="status-locked";
        }else{
            status="è§£æ”¾æ¸ˆ"; cls="status-unlocked";
        }

        const li=document.createElement("li");
        li.className="app-card";
        li.innerHTML=`
            <div class="app-icon">${app.icon}</div>
            <div>
                <p class="app-title">${app.name}</p>
                <p class="app-desc">${app.description}</p>
            </div>
            <div class="app-right">
                <div class="app-status ${cls}">${status}</div>
                ${unlocked?`<button class="relock-btn">å†ãƒ­ãƒƒã‚¯</button>`:""}
            </div>
        `;
        li.onclick=()=>launchApp(app);

        const btn=li.querySelector(".relock-btn");
        if(btn){
            btn.onclick=e=>{
                e.stopPropagation();
                currentApp=app;
                openRelock();
            };
        }
        list.appendChild(li);
    });
}

/* ===== èµ·å‹• & å‘ãåˆ¤å®š ===== */
function launchApp(app){
    if(!app.enabled) return;

    if(app.password && !getC(`unlock_${app.id}`)){
        currentApp=app;
        openPassword();
        return;
    }

    checkOrientation(app);
}

function checkOrientation(app){
    const isMobile=/Mobi|Android|iPhone/i.test(navigator.userAgent);
    if(!isMobile){ location.href=app.url; return; }

    const isLandscape=innerWidth>innerHeight;
    if(
        (app.orientation==="landscape" && isLandscape) ||
        (app.orientation==="portrait" && !isLandscape)
    ){
        location.href=app.url;
    }else{
        pendingUrl=app.url;
        requiredOrientation=app.orientation;
        openOrientation(app.orientation);
    }
}

/* ===== å‘ããƒ¢ãƒ¼ãƒ€ãƒ« ===== */
const oModal=document.getElementById("orientationModal");
const oTitle=document.getElementById("oriTitle");
const oText=document.getElementById("oriText");

function openOrientation(type){
    oTitle.textContent=type==="landscape"?"æ¨ªç”»é¢ã«ã—ã¦ãã ã•ã„":"ç¸¦ç”»é¢ã«ã—ã¦ãã ã•ã„";
    oText.textContent="ç«¯æœ«ã®å‘ãã‚’å¤‰æ›´ã—ã¦ãã ã•ã„";
    oModal.classList.add("active");
}
function closeOrientation(){ oModal.classList.remove("active"); }

window.addEventListener("resize",()=>{
    if(!pendingUrl) return;
    const isLandscape=innerWidth>innerHeight;
    if(
        (requiredOrientation==="landscape" && isLandscape) ||
        (requiredOrientation==="portrait" && !isLandscape)
    ){
        location.href=pendingUrl;
    }
});

/* ===== ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ===== */
const pwModal=document.getElementById("passwordModal");
const pwInput=document.getElementById("pwInput");
const pwError=document.getElementById("pwError");

function openPassword(){
    pwInput.value=""; pwError.style.display="none";
    pwModal.classList.add("active");
}
function closePassword(){ pwModal.classList.remove("active"); }

function submitPassword(){
    if(pwInput.value===currentApp.password){
        setC(`unlock_${currentApp.id}`,"1",7);
        setC(`ver_${currentApp.id}`,currentApp.version,7);
        closePassword();
        render();
    }else pwError.style.display="block";
}

/* ===== å†ãƒ­ãƒƒã‚¯ ===== */
const rModal=document.getElementById("relockModal");
function openRelock(){ rModal.classList.add("active"); }
function closeRelock(){ rModal.classList.remove("active"); }
function confirmRelock(){
    delC(`unlock_${currentApp.id}`);
    delC(`ver_${currentApp.id}`);
    closeRelock();
    render();
}

render();
</script>
</body>
</html>
